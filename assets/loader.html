<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Arrow -> Stoplight -> Cone</title>
    <style>
        /* --- 1. SETUP & BACKGROUND --- */
        :root {
            --bg-color: #eef2f6;
            --arrow-blue: #4285F4;
            --cone-orange: #FF6700;
            --traffic-dark: #2d2d2d;
        }

        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--bg-color);
            /* Subtle Dot Map Pattern */
            background-image: radial-gradient(#dbe3ed 2px, transparent 2px);
            background-size: 24px 24px;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
        }

        .loader-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 50px; /* Space between loader and badge */
        }

        .scene {
            position: relative;
            width: 120px;
            height: 120px; /* Bounding box for animations */
            display: flex;
            justify-content: center;
            align-items: center;
            /* 3D Perspective for better rotations */
            perspective: 1000px;
        }

        /* --- 2. THE MORPH OBJECT --- */
        .morph-object {
            width: 60px;
            height: 70px;
            position: relative;
            z-index: 10;

            /* The Magic: Elastic Physics */
            transition:
                clip-path 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55),
                background-color 0.5s ease,
                transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);

            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }

        /* --- STATE A: ARROW (Locating) --- */
        .morph-object.state-arrow {
            background-color: var(--arrow-blue);
            /* Arrow Polygon (Standard Cursor) */
            clip-path: polygon(50% 0, 0% 100%, 50% 80%, 100% 100%);
            /* Tilted slightly like a GPS arrow */
            transform: rotate(45deg) translate(-5px, -5px);
            animation: arrow-float 1.5s ease-in-out infinite alternate;
        }

        /* --- STATE B: STOP LIGHT (Checking) --- */
        .morph-object.state-light {
            background-color: var(--traffic-dark);
            /* Rectangular Box */
            clip-path: polygon(20% 0%, 20% 100%, 80% 100%, 80% 0%);
            transform: rotate(0deg) scale(1.1);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        /* The Lights (Red/Yellow/Green) drawn with gradients */
        .morph-object::before {
            content: '';
            position: absolute;
            inset: 0;
            opacity: 0;
            transition: opacity 0.3s;
            /* 3 Radial Gradients = 3 Lights */
            background:
                radial-gradient(circle at 50% 20%, #ff5252 6px, transparent 7px), /* Red */
                radial-gradient(circle at 50% 50%, #ffeb3b 6px, transparent 7px), /* Yellow */
                radial-gradient(circle at 50% 80%, #4caf50 6px, transparent 7px); /* Green */
        }

        .morph-object.state-light::before {
            opacity: 1;
            /* Simple pulse animation */
            animation: traffic-blink 1s infinite;
        }

        /* --- STATE C: CONE (Rerouting) --- */
        .morph-object.state-cone {
            background-color: var(--cone-orange);
            /* Trapezoid */
            clip-path: polygon(25% 15%, 15% 100%, 85% 100%, 75% 15%);
            transform: rotate(0deg) translateY(0);
        }

        /* Cone Stripes (White Reflective Bands) */
        .morph-object::after {
            content: '';
            position: absolute;
            inset: 0;
            opacity: 0;
            transition: opacity 0.3s;
            background: linear-gradient(
                to bottom,
                transparent 35%,
                rgba(255,255,255,0.9) 35%,
                rgba(255,255,255,0.9) 45%,
                transparent 45%,
                transparent 55%,
                rgba(255,255,255,0.9) 55%,
                rgba(255,255,255,0.9) 65%,
                transparent 65%
            );
        }

        .morph-object.state-cone::after {
            opacity: 1;
        }

        /* --- 3. CONE BASE (Separate Element) --- */
        .cone-base {
            position: absolute;
            bottom: 25px; /* Aligned with bottom of morph object */
            width: 70px;
            height: 8px;
            background-color: var(--cone-orange);
            border-radius: 4px;
            z-index: 5;
            transform: scaleX(0); /* Hidden */
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
        }

        .cone-base.visible {
            transform: scaleX(1); /* Expand */
            opacity: 1;
        }

        /* --- 4. BADGE TITLE (Glassmorphism) --- */
        .info-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 12px 24px;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 180px;
            justify-content: center;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--arrow-blue);
            transition: background-color 0.4s;
            box-shadow: 0 0 0 2px rgba(255,255,255,0.5), 0 0 10px currentColor;
        }

        .status-text {
            font-size: 0.85rem;
            font-weight: 800;
            color: #555;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        /* --- ANIMATIONS --- */
        @keyframes arrow-float {
            0% { transform: rotate(45deg) translate(-5px, -5px); }
            100% { transform: rotate(45deg) translate(-5px, -12px); }
        }

        @keyframes traffic-blink {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

    </style>
</head>
<body>

    <div class="loader-container">
        <div class="scene">
            <!-- The Main Changing Shape -->
            <div class="morph-object state-arrow" id="morphShape"></div>
            <!-- The Cone Base (Only visible in cone state) -->
            <div class="cone-base" id="coneBase"></div>
        </div>

        <!-- The Glass Badge -->
        <div class="info-card">
            <div class="status-dot" id="statusDot"></div>
            <div class="status-text" id="statusText">LOCATING...</div>
        </div>
    </div>

    <script>
        const shape = document.getElementById('morphShape');
        const base = document.getElementById('coneBase');
        const text = document.getElementById('statusText');
        const dot = document.getElementById('statusDot');

        // Timing Configuration (Milliseconds)
        const STEP_DURATION = 1800;

        function runSequence() {

            // --- STEP 1: ARROW (Start) ---
            setArrow();

            // --- STEP 2: STOP LIGHT (After 1.8s) ---
            setTimeout(() => {
                setStopLight();
            }, STEP_DURATION);

            // --- STEP 3: CONE (After 3.6s) ---
            setTimeout(() => {
                setCone();
            }, STEP_DURATION * 2);
        }

        function setArrow() {
            shape.className = 'morph-object state-arrow';
            base.classList.remove('visible');

            text.innerText = "LOCATING...";
            dot.style.backgroundColor = "#4285F4"; // Google Blue
            dot.style.boxShadow = "0 0 0 2px rgba(255,255,255,0.5), 0 0 10px #4285F4";
        }

        function setStopLight() {
            shape.className = 'morph-object state-light';
            base.classList.remove('visible');

            text.innerText = "CHECKING TRAFFIC";
            dot.style.backgroundColor = "#2d2d2d"; // Dark Gray
            dot.style.boxShadow = "0 0 0 2px rgba(255,255,255,0.5), 0 0 10px #2d2d2d";
        }

        function setCone() {
            shape.className = 'morph-object state-cone';
            base.classList.add('visible');

            text.innerText = "REROUTING";
            dot.style.backgroundColor = "#FF6700"; // Safety Orange
            dot.style.boxShadow = "0 0 0 2px rgba(255,255,255,0.5), 0 0 10px #FF6700";
        }

        // Initialize loop
        runSequence();

        // Loop continuously
        setInterval(runSequence, STEP_DURATION * 3);

    </script>
</body>
</html>
